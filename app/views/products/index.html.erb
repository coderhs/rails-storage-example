<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-8">Products with Images</h1>

  <div class="mb-4">
    <%= link_to "â† Back to Uploads", root_path, class: "text-blue-500 hover:underline" %>
  </div>

  <div id="flash">
    <% if notice %>
      <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
        <%= notice %>
      </div>
    <% end %>
  </div>

  <!-- Product Form -->
  <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-8">
    <h2 class="text-xl font-semibold mb-4">Add Images to Product</h2>

    <%= render "form", product: @product, products: @products %>
  </div>

  <!-- Products List -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold mb-4">Products</h2>
    <div id="products" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <% @products.each do |product| %>
        <%= render partial: "product", locals: { product: product } %>
      <% end %>
    </div>
  </div>

  <!-- Products Table -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold mb-4">Products Table</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white shadow-md rounded">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 py-2 text-left">ID</th>
            <th class="px-4 py-2 text-left">Name</th>
            <th class="px-4 py-2 text-left">Images Count</th>
            <th class="px-4 py-2 text-left">Created At</th>
          </tr>
        </thead>
        <tbody id="products_table">
          <% @products.each do |product| %>
            <tr class="border-t" id="product_row_<%= product.id %>">
              <td class="px-4 py-2"><%= product.id %></td>
              <td class="px-4 py-2"><%= product.name %></td>
              <td class="px-4 py-2"><%= product.images.count %></td>
              <td class="px-4 py-2"><%= product.created_at.strftime("%Y-%m-%d %H:%M") %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Active Storage Attachments Table -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold mb-4">Active Storage Attachments</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white shadow-md rounded">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 py-2 text-left">ID</th>
            <th class="px-4 py-2 text-left">Name</th>
            <th class="px-4 py-2 text-left">Record Type</th>
            <th class="px-4 py-2 text-left">Record ID</th>
            <th class="px-4 py-2 text-left">Blob ID</th>
            <th class="px-4 py-2 text-left">Created At</th>
          </tr>
        </thead>
        <tbody id="attachments">
          <% @products.each do |product| %>
            <% product.images.each do |attachment| %>
              <tr class="border-t" id="attachment_<%= attachment.id %>">
                <td class="px-4 py-2"><%= attachment.id %></td>
                <td class="px-4 py-2"><%= attachment.name %></td>
                <td class="px-4 py-2"><%= attachment.record_type %></td>
                <td class="px-4 py-2"><%= attachment.record_id %></td>
                <td class="px-4 py-2"><%= attachment.blob_id %></td>
                <td class="px-4 py-2"><%= attachment.created_at.strftime("%Y-%m-%d %H:%M") %></td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Active Storage Blobs Table -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold mb-4">Active Storage Blobs</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white shadow-md rounded">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 py-2 text-left">ID</th>
            <th class="px-4 py-2 text-left">Key</th>
            <th class="px-4 py-2 text-left">Filename</th>
            <th class="px-4 py-2 text-left">Content Type</th>
            <th class="px-4 py-2 text-left">Byte Size</th>
            <th class="px-4 py-2 text-left">Checksum</th>
            <th class="px-4 py-2 text-left">Created At</th>
          </tr>
        </thead>
        <tbody id="blobs">
          <% @products.each do |product| %>
            <% product.images.each do |attachment| %>
              <% blob = attachment.blob %>
              <tr class="border-t" id="blob_<%= blob.id %>">
                <td class="px-4 py-2"><%= blob.id %></td>
                <td class="px-4 py-2 text-xs font-mono"><%= truncate(blob.key, length: 20) %></td>
                <td class="px-4 py-2"><%= blob.filename %></td>
                <td class="px-4 py-2"><%= blob.content_type %></td>
                <td class="px-4 py-2"><%= number_to_human_size(blob.byte_size) %></td>
                <td class="px-4 py-2 text-xs font-mono"><%= truncate(blob.checksum, length: 15) %></td>
                <td class="px-4 py-2"><%= blob.created_at.strftime("%Y-%m-%d %H:%M") %></td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
